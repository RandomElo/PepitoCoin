on:
    push:
        branches:
            - main

name: ğŸš€ Publication

jobs:
    web-deploy:
        name: ğŸ‰ DÃ©ploiement
        runs-on: ubuntu-latest

        steps:
            - name: ğŸšš Obtention du dernier code
              uses: actions/checkout@v2

            - name: ğŸ’» Configuration de Node.js
              uses: actions/setup-node@v2
              with:
                  node-version: 18

            - name: ğŸ’¾ Installation des dÃ©pendances
              run: npm install
              working-directory: backend

            - name: ğŸ“¦ CrÃ©ation de l'archive node_modules
              run: tar -czf node_modules.tar.gz -C backend node_modules
              working-directory: backend

            - name: ğŸ CrÃ©er un artefact
              uses: actions/upload-artifact@v2
              with:
                  name: node_modules
                  path: backend/node_modules.tar.gz

            - name: ğŸ“‚ TÃ©lÃ©chargement et extraction de l'archive sur le serveur FTP
              uses: actions/download-artifact@v2
              with:
                  name: node_modules
                  path: backend

            - name: ğŸ“¦ Extraction de l'archive node_modules
              run: tar -xzf backend/node_modules.tar.gz -C backend
              working-directory: backend

            - name: ğŸ“‚ Synchronisation des fichiers
              uses: SamKirkland/FTP-Deploy-Action@v4.3.4
              with:
                  server: ${{ secrets.SERVER }}
                  username: ${{ secrets.USERNAME }}
                  password: ${{ secrets.PASSWORD }}
                  local-dir: ./
                  server-dir: ./
